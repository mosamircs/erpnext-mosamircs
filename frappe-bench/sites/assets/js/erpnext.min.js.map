{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/erpnext/erpnext/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/supplier_quick_entry.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js","../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js","../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js","../../../apps/erpnext/erpnext/public/js/telephony.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_or_batch_no: function() {\n\t\tlet grid_row = cur_frm.open_grid_row();\n\t\tif (!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status() !== \"Write\") return;\n\n\t\tfrappe.model.get_value('Item', {'name': grid_row.doc.item_code},\n\t\t\t['has_serial_no', 'has_batch_no'], ({has_serial_no, has_batch_no}) => {\n\t\t\t\tObject.assign(grid_row.doc, {has_serial_no, has_batch_no});\n\n\t\t\t\tif (has_serial_no) {\n\t\t\t\t\tattach_selector_button(__(\"Add Serial No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.serial_no.$wrapper, this, grid_row);\n\t\t\t\t} else if (has_batch_no) {\n\t\t\t\t\tattach_selector_button(__(\"Pick Batch No\"),\n\t\t\t\t\t\tgrid_row.grid_form.fields_dict.batch_no.$wrapper, this, grid_row);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype('Journal Entry', () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc('Journal Entry');\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\" ;\n\t\t\t});\n\t\t\tfrappe.set_route('Form','Journal Entry', journal_entry.name);\n\t\t});\n\t},\n\n\troute_to_pending_reposts: (args) => {\n\t\tfrappe.set_route('List', 'Repost Item Valuation', args);\n\t},\n\n\tproceed_save_with_reminders_frequency_change: () => {\n\t\tfrappe.ui.hide_open_dialog();\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.hr.doctype.hr_settings.hr_settings.set_proceed_with_frequency_change',\n\t\t\tcallback: () => {\n\t\t\t\tcur_frm.save();\n\t\t\t}\n\t\t});\n\t}\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.show();\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tadd_dimensions: function(report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\tcallback: function(r) {\n\t\t\t\tlet accounting_dimensions = r.message[0];\n\t\t\t\taccounting_dimensions.forEach((dimension) => {\n\t\t\t\t\tlet found = filters.some(el => el.fieldname === dimension['fieldname']);\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tfilters.splice(index, 0, {\n\t\t\t\t\t\t\t\"fieldname\": dimension[\"fieldname\"],\n\t\t\t\t\t\t\t\"label\": __(dimension[\"label\"]),\n\t\t\t\t\t\t\t\"fieldtype\": \"MultiSelectList\",\n\t\t\t\t\t\t\tget_data: function(txt) {\n\t\t\t\t\t\t\t\treturn frappe.db.get_link_options(dimension[\"document_type\"], txt);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\toverrides_parent_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tif (doc[parent_fieldname]) {\n\t\t\tlet cl = doc[table_fieldname] || [];\n\t\t\tfor (let i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t\tfrappe.refresh_field(table_fieldname);\n\t\t}\n\t},\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t}\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\tfrappe.model.set_value(row.doctype, row.name, opts.original_item_field, d.item_code);\n\t\t\t\tfrm.trigger(item_field, row.doctype, row.name);\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find(f => f.fieldname == fieldname).precision;\n\n\tthis.data = [];\n\tconst fields = [{\n\t\tfieldtype:'Data',\n\t\tfieldname:\"docname\",\n\t\tread_only: 1,\n\t\thidden: 1,\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:\"item_code\",\n\t\toptions: 'Item',\n\t\tin_list_view: 1,\n\t\tread_only: 0,\n\t\tdisabled: 0,\n\t\tlabel: __('Item Code'),\n\t\tget_query: function() {\n\t\t\tlet filters;\n\t\t\tif (frm.doc.doctype == 'Sales Order') {\n\t\t\t\tfilters = {\"is_sales_item\": 1};\n\t\t\t} else if (frm.doc.doctype == 'Purchase Order') {\n\t\t\t\tif (frm.doc.is_subcontracted == \"Yes\") {\n\t\t\t\t\tfilters = {\"is_sub_contracted_item\": 1};\n\t\t\t\t} else {\n\t\t\t\t\tfilters = {\"is_purchase_item\": 1};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\n\t\t\t\tfilters: filters\n\t\t\t};\n\t\t}\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:'uom',\n\t\toptions: 'UOM',\n\t\tread_only: 0,\n\t\tlabel: __('UOM'),\n\t\treqd: 1,\n\t\tonchange: function () {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\tcallback: r => {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some(doc => {\n\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tfieldtype:'Float',\n\t\tfieldname:\"qty\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Qty'),\n\t\tprecision: get_precision(\"qty\")\n\t}, {\n\t\tfieldtype:'Currency',\n\t\tfieldname:\"rate\",\n\t\toptions: \"currency\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Rate'),\n\t\tprecision: get_precision(\"rate\")\n\t}];\n\n\tif (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order' ) {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: 'Date',\n\t\t\tfieldname: frm.doc.doctype == 'Sales Order' ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == 'Sales Order' ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1\n\t\t})\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: 'Float',\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision('conversion_factor')\n\t\t})\n\t}\n\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: false,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"].filter((item) => !!item.item_code);\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"name\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t\t\"uom\": d.uom\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tfunction _map() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t\"args\": opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => query_args;\n\t}\n\n\tif (opts.source_doctype) {\n\t\tconst d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\tallow_child_item_selection: opts.allow_child_item_selection,\n\t\t\tchild_fieldname: opts.child_fieldname,\n\t\t\tchild_columns: opts.child_columns,\n\t\t\tsize: opts.size,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif (values.length === 0) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\tif (opts.allow_child_item_selection) {\n\t\t\t\t\t// args contains filtered child docnames\n\t\t\t\t\topts.args = args;\n\t\t\t\t}\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\n\t\treturn d;\n\t}\n\n\tif (opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif (doc && value && doc.item_name && doc.item_name !== value && doc.item_code === value) {\n\t\treturn value + ': ' + doc.item_name;\n\t} else if (!value && doc.doctype && doc.item_name) {\n\t\t// format blank value in child table\n\t\treturn doc.item_name;\n\t} else {\n\t\t// if value is blank in report view or item code and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif (doc && value && doc.employee_name && doc.employee_name !== value && doc.employee === value) {\n\t\treturn value + ': ' + doc.employee_name;\n\t} else if (!value && doc.doctype && doc.employee_name) {\n\t\t// format blank value in child table\n\t\treturn doc.employee;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Project'] = function(value, doc) {\n\tif (doc && value && doc.project_name && doc.project_name !== value && doc.project === value) {\n\t\treturn value + ': ' + doc.project_name;\n\t} else if (!value && doc.doctype && doc.project_name) {\n\t\t// format blank value in child table\n\t\treturn doc.project;\n\t} else {\n\t\t// if value is blank in report view or project name and name are the same, return as is\n\t\treturn value;\n\t}\n};\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n\nfunction attach_selector_button(inner_text, append_loction, context, grid_row) {\n\tlet $btn_div = $(\"<div>\").css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t.appendTo(append_loction);\n\tlet $btn = $(`<button class=\"btn btn-sm btn-default\">${inner_text}</button>`)\n\t\t.appendTo($btn_div);\n\n\t$btn.on(\"click\", function() {\n\t\tcontext.show_serial_batch_selector(grid_row.frm, grid_row.doc, \"\", \"\", true);\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'ERPNext Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'E-commerce': 'Website',\n\t'Contacts': 'CRM'\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tdispatch_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t};\n\t},\n\n\tget_filtered_dimensions: function(doc, child_fields, dimension, company) {\n\t\tlet account = '';\n\n\t\tchild_fields.forEach((field) => {\n\t\t\tif (!account) {\n\t\t\t\taccount = doc[field];\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tquery: \"erpnext.controllers.queries.get_filtered_dimensions\",\n\t\t\tfilters: {\n\t\t\t\t'dimension': dimension,\n\t\t\t\t'account': account,\n\t\t\t\t'company': company\n\t\t\t}\n\t\t};\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nconst SALES_DOCTYPES = ['Quotation', 'Sales Order', 'Delivery Note', 'Sales Invoice'];\nconst PURCHASE_DOCTYPES = ['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'];\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (!args) {\n\t\tif ((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && frm.doc.quotation_to === \"Lead\") {\n\t\t\t\tparty_type = \"Lead\";\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (!args) {\n\t\t\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: 'Customer'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: 'Supplier'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!args || !args.party) return;\n\n\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\targs.fetch_payment_terms_template = cint(!frm.doc.ignore_default_payment_terms_template);\n\t}\n\n\tif (in_list(SALES_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.company_address) {\n\t\t\targs.company_address = frm.doc.company_address;\n\t\t}\n\t}\n\n\tif (in_list(PURCHASE_DOCTYPES, frm.doc.doctype)) {\n\t\tif (!args.company_address && frm.doc.billing_address) {\n\t\t\targs.company_address = frm.doc.billing_address;\n\t\t}\n\n\t\tif (!args.shipping_address && frm.doc.shipping_address) {\n\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t}\n\t}\n\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc){\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.set_taxes = function(frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.get_contact_details = function (frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: { contact: frm.doc.contact_person },\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r.message) frm.set_value(r.message);\n\t\t\t},\n\t\t});\n\t} else {\n\t\tfrm.set_value({\n\t\t\tcontact_person: \"\",\n\t\t\tcontact_display: \"\",\n\t\t\tcontact_email: \"\",\n\t\t\tcontact_mobile: \"\",\n\t\t\tcontact_phone: \"\",\n\t\t\tcontact_designation: \"\",\n\t\t\tcontact_department: \"\",\n\t\t});\n\t}\n};\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({message:__(\"Please enter {0} first\", [label]), title:__(\"Mandatory\")});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback) {\n\tif (frm.doc.company) {\n\t\tif ((frm.doc.inter_company_order_reference || frm.doc.internal_invoice_reference ||\n\t\t\tfrm.doc.internal_order_reference)) {\n\t\t\tif (callback) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t}\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text();\n\t},\n\n\tselect_text() {\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\t$(this).select();\n\t\t});\n\t},\n\n\tset_payment_primary_action: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function() {\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event();\n\t\tthis.clear_amount();\n\t},\n\n\tmake_multimode_payment: function() {\n\t\tvar me = this;\n\n\t\tif (this.frm.doc.change_amount > 0) {\n\t\t\tme.payment_val = me.doc.outstanding_amount;\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function() {\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif (this.frm.doc.payments.length) {\n\t\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function() {\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row();\n\t\tthis.payment_val = 0.0;\n\t\tif (this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0) {\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount();\n\t\t} else if (flt(this.selected_mode.val()) > 0) {\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\n\tbind_keyboard_event() {\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t});\n\n\t\t$(this.$body).find('.form-control').click(function() {\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t});\n\n\t\t$(this.$body).find('.write_off_amount').change(function() {\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t});\n\n\t\t$(this.$body).find('.change_amount').change(function() {\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t});\n\t},\n\n\thighlight_selected_row() {\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\", {'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode');\n\t\tselected_row.addClass('selected-payment-mode');\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\n\tbind_numeric_keys_event: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t});\n\n\t\t$(this.$body).find('.delete-btn').click(function() {\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\n\tbind_amount_change_event() {\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function() {\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\");\n\t\t\tme.update_payment_amount();\n\t\t});\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e) {\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t});\n\t},\n\n\twrite_off_amount(write_off_amount) {\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount();\n\t\tthis.show_amounts();\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif (in_list(['change_amount', 'write_off_amount'], this.idx)) {\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif (me.idx == 'change_amount') {\n\t\t\t\tme.change_amount(value);\n\t\t\t} else {\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.update_payment_amount();\n\t\t}\n\t},\n\n\tupdate_payment_amount: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data) {\n\t\t\tif (cint(me.idx) == cint(data.idx)) {\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2);\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency));\n\t\tthis.update_invoice();\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {\n\t\tthis.fetch_round_off_accounts();\n\t},\n\n\tapply_pricing_rule_on_item: function(item) {\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tlet item_rate = item.rate;\n\t\tif (in_list([\"Sales Order\", \"Quotation\"], item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif (item.margin_type == \"Percentage\") {\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif (item.discount_percentage) {\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem_rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t\titem.discount_percentage = 100 * flt(item.discount_amount) / flt(item.rate_with_margin);\n\t\t}\n\n\t\tfrappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n\t},\n\n\tcalculate_taxes_and_totals: async function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// # Update grand total as per cash and non trade discount\n\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\tthis.frm.doc.grand_total -= this.frm.doc.discount_amount;\n\t\t\tthis.frm.doc.base_grand_total -= this.frm.doc.base_discount_amount;\n\t\t}\n\n\t\tawait this.calculate_shipping_charges();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_pos &&\n\t\t\tthis.frm.doc.is_return) {\n\t\t\tif (this.frm.doc.doctype == \"Sales Invoice\") {\n\t\t\t\tthis.set_total_amount_to_default_mop();\n\t\t\t}\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif(this.frm.doc.doctype === \"Purchase Invoice\" && this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function() {\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst subs =  [conversion_rate_label, this.frm.doc.currency, company_currency];\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', subs);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tlet me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\n\t\t\t\tif ((!item.qty) && me.frm.doc.is_return) {\n\t\t\t\t\titem.amount = flt(item.rate * -1, precision(\"amount\", item));\n\t\t\t\t} else if ((!item.qty) && me.frm.doc.is_debit_note) {\n\t\t\t\t\titem.amount = flt(item.rate, precision(\"amount\", item));\n\t\t\t\t} else {\n\t\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\ttax.item_wise_tax_detail = {};\n\t\t\t}\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tfetch_round_off_accounts: function() {\n\t\tlet me = this;\n\t\tfrappe.flags.round_off_applicable_accounts = [];\n\n\t\tif (me.frm.doc.company) {\n\t\t\treturn frappe.call({\n\t\t\t\t\"method\": \"erpnext.controllers.taxes_and_totals.get_round_off_applicable_accounts\",\n\t\t\t\t\"args\": {\n\t\t\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\t\t\"account_list\": frappe.flags.round_off_applicable_accounts\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.flags.round_off_applicable_accounts.push(...r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\t},\n\n\tcalculate_shipping_charges: function() {\n\t\t// Do not apply shipping rule for POS\n\t\tif (this.frm.doc.is_pos) {\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"shipping_rule\", this.frm.doc.name)) {\n\t\t\treturn this.shipping_rule();\n\t\t}\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\tme.round_off_base_values(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax, [\"total\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\n\t\tif (!tax.dont_recompute_tax) {\n\t\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\t\t}\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tif(typeof (tax_detail) == \"string\") {\n\t\t\ttax.item_wise_tax_detail = JSON.parse(tax.item_wise_tax_detail);\n\t\t\ttax_detail = tax.item_wise_tax_detail;\n\t\t}\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.tax_amount= Math.round(tax.tax_amount);\n\t\t\ttax.tax_amount_after_discount_amount = Math.round(tax.tax_amount_after_discount_amount);\n\t\t}\n\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tround_off_base_values: function(tax) {\n\t\tif (frappe.flags.round_off_applicable_accounts.includes(tax.account_head)) {\n\t\t\ttax.base_tax_amount= Math.round(tax.base_tax_amount);\n\t\t\ttax.base_tax_amount_after_discount_amount = Math.round(tax.base_tax_amount_after_discount_amount);\n\t\t}\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can because of rounding adjustment issue and on-screen discrepancy\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\tif (!tax.dont_recompute_tax) {\n\t\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tif (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = 0;\n\t\t}\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t\tthis.calculate_write_off_amount();\n\t},\n\n\tis_internal_invoice: function() {\n\t\tif (['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tif (this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif (this.frm.doc.is_return || (this.frm.doc.docstatus > 0) || this.is_internal_invoice()) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tset_total_amount_to_default_mop: function() {\n\t\tlet grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\tlet base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(flt(base_grand_total, precision(\"base_grand_total\"))\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\t\tthis.frm.doc.payments.find(pay => {\n\t\t\tif (pay.default) {\n\t\t\t\tpay.amount = total_amount_to_pay;\n\t\t\t}\n\t\t});\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount, amount;\n\n\t\t\t\t\tif (me.frm.doc.party_account_currency == me.frm.doc.currency) {\n\t\t\t\t\t\t// if customer/supplier currency is same as company currency\n\t\t\t\t\t\t// total_amount_to_pay is already in customer/supplier currency\n\t\t\t\t\t\t// so base_amount has to be calculated using total_amount_to_pay\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay, precision(\"amount\", data));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\t\tamount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t},\n\n\tcalculate_change_amount: function() {\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total,\n\t\t\t\t\tprecision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total, precision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function() {\n\t\tif (this.frm.doc.write_off_outstanding_amount_automatically) {\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.outstanding_amount, precision(\"write_off_amount\"));\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\n\t\t\tthis.calculate_outstanding_amount(false);\n\t\t}\n\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\n\tsetup: function() {\n\t\tthis._super();\n\t\tlet me = this;\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\tcur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif (!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.target_warehouse && frm.doc.set_target_warehouse) {\n\t\t\t\t\titem.target_warehouse = frm.doc.set_target_warehouse;\n\t\t\t\t}\n\n\t\t\t\tif (!item.from_warehouse && frm.doc.set_from_warehouse) {\n\t\t\t\t\titem.from_warehouse = frm.doc.set_from_warehouse;\n\t\t\t\t}\n\n\t\t\t\terpnext.accounts.dimensions.copy_dimension_from_first_row(frm, cdt, cdn, 'items');\n\t\t\t}\n\t\t});\n\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\n\t\tlet batch_no_field = this.frm.get_docfield(\"items\", \"batch_no\");\n\t\tif (batch_no_field) {\n\t\t\tbatch_no_field.get_route_options_for_new_doc = function(row) {\n\t\t\t\treturn {\n\t\t\t\t\t\"item\": row.doc.item_code\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tvar item = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\n\t\t\t\t\t\t\"item\": item.item_code\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict.taxes_and_charges) {\n\t\t\tthis.frm.set_query(\"taxes_and_charges\", function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['company', '=', me.frm.doc.company],\n\t\t\t\t\t\t['docstatus', '!=', 2]\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.frm.trigger('set_default_internal_warehouse');\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\n\tis_return: function() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t},\n\n\tsetup_quality_inspection: function() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst me = this;\n\t\tif (!this.frm.is_new() && this.frm.doc.docstatus === 0) {\n\t\t\tthis.frm.add_custom_button(__(\"Quality Inspection(s)\"), () => {\n\t\t\t\tme.make_quality_inspection();\n\t\t\t}, __(\"Create\"));\n\t\t\tthis.frm.page.set_inner_btn_group_as_primary(__('Create'));\n\t\t}\n\n\t\tconst inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tlet quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tlet d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_payment_request: function() {\n\t\tvar me = this;\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\n\tonload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t},\n\n\trefresh: function() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t},\n\n\tscan_barcode: function() {\n\t\tlet me = this;\n\n\t\tif(this.frm.doc.scan_barcode) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_for_serial_or_batch_or_barcode_number\",\n\t\t\t\targs: {\n\t\t\t\t\tsearch_value: this.frm.doc.scan_barcode\n\t\t\t\t}\n\t\t\t}).then(r => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('Cannot find Item with this Barcode'),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.modify_table_after_scan(data);\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t},\n\n\tmodify_table_after_scan(data) {\n\t\tlet scan_barcode_field = this.frm.fields_dict[\"scan_barcode\"];\n\t\tlet cur_grid = this.frm.fields_dict.items.grid;\n\t\tlet row_to_modify = null;\n\n\t\t// Check if batch is scanned and table has batch no field\n\t\tlet batch_no_scan = Boolean(data.batch_no) && frappe.meta.has_field(cur_grid.doctype, \"batch_no\");\n\n\t\tif (batch_no_scan) {\n\t\t\trow_to_modify = this.get_batch_row_to_modify(data.batch_no);\n\t\t} else {\n\t\t\t// serial or barcode scan\n\t\t\trow_to_modify = this.get_row_to_modify_on_scan(row_to_modify, data);\n\t\t}\n\n\t\tif (!row_to_modify) {\n\t\t\t// add new row if new item/batch is scanned\n\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc, cur_grid.doctype, 'items');\n\t\t}\n\n\t\tthis.show_scan_message(row_to_modify.idx, row_to_modify.item_code);\n\t\tthis.set_scanned_values(row_to_modify, data, scan_barcode_field);\n\t},\n\n\tset_scanned_values(row_to_modify, data, scan_barcode_field) {\n\t\t// increase qty and set scanned value and item in row\n\t\tthis.frm.from_barcode = this.frm.from_barcode ? this.frm.from_barcode + 1 : 1;\n\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, {\n\t\t\titem_code: data.item_code,\n\t\t\tqty: (row_to_modify.qty || 0) + 1\n\t\t});\n\n\t\t['serial_no', 'batch_no', 'barcode'].forEach(field => {\n\t\t\tif (data[field] && frappe.meta.has_field(row_to_modify.doctype, field)) {\n\t\t\t\tlet is_serial_no = row_to_modify[field] && field === \"serial_no\";\n\t\t\t\tlet value = data[field];\n\n\t\t\t\tif (is_serial_no) {\n\t\t\t\t\tvalue = row_to_modify[field] + '\\n' + data[field];\n\t\t\t\t}\n\n\t\t\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, field, value);\n\t\t\t}\n\t\t});\n\n\t\tscan_barcode_field.set_value('');\n\t\trefresh_field(\"items\");\n\t},\n\n\tget_row_to_modify_on_scan(row_to_modify, data) {\n\t\t// get an existing item row to increment or blank row to modify\n\t\tconst existing_item_row = this.frm.doc.items.find(d => d.item_code === data.item_code);\n\t\tconst blank_item_row = this.frm.doc.items.find(d => !d.item_code);\n\n\t\tif (existing_item_row) {\n\t\t\trow_to_modify = existing_item_row;\n\t\t} else if (blank_item_row) {\n\t\t\trow_to_modify = blank_item_row;\n\t\t}\n\n\t\treturn row_to_modify;\n\t},\n\n\tget_batch_row_to_modify(batch_no) {\n\t\t// get row if batch already exists in table\n\t\tconst existing_batch_row = this.frm.doc.items.find(d => d.batch_no === batch_no);\n\t\treturn existing_batch_row || null;\n\t},\n\n\tshow_scan_message (idx, exist = null) {\n\t\t// show new row or qty increase toast\n\t\tif (exist) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Row #{0}: Qty increased by 1', [idx]),\n\t\t\t\tindicator: 'green'\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Row #{0}: Item added', [idx]),\n\t\t\t\tindicator: 'green'\n\t\t\t});\n\t\t}\n\t},\n\n\tapply_default_taxes() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges || \"\",\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tdebounce: 2000,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_sms: function() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t},\n\n\tsend_sms: function() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t},\n\n\tbarcode: function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.barcode==\"\" || d.barcode==null) {\n\t\t\t// barcode cleared, remove item\n\t\t\td.item_code = \"\";\n\t\t}\n\n\t\tthis.frm.from_barcode = this.frm.from_barcode ? this.frm.from_barcode + 1 : 1;\n\t\tthis.item_code(doc, cdt, cdn);\n\t},\n\n\titem_code: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\n\t\titem.weight_per_unit = 0;\n\t\titem.weight_uom = '';\n\t\titem.conversion_factor = 0;\n\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\t// clear barcode if setting item (else barcode will take priority)\n\t\tif (this.frm.from_barcode == 0) {\n\t\t\titem.barcode = null;\n\t\t}\n\t\tthis.frm.from_barcode = this.frm.from_barcode - 1 >= 0 ? this.frm.from_barcode - 1 : 0;\n\n\n\t\tif(item.item_code || item.barcode || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\titem.pricing_rules = ''\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_return: cint(me.frm.doc.is_return),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tnet_rate: item.rate,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_docname: item.name\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t\tif (d.free_item_data) {\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n\t\t\t\t\t\t\t\t\t\t\tme.frm.doc.doctype, me.frm.doc.company);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\n\t\t\t\t\t\t\t\t\t\t\t\t(r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// check if batch serial selector is disabled or not\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\n\t\t\t\t\t\t\t\t\t\t\t.then((value) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tme.apply_price_list(item, true);\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\t\t\t\t\t\tme.update_item_grid_labels(company_currency);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tprice_list_rate: function(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tfrappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\n\n\t\t// check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), cdt)\n\t\t\tthis.apply_pricing_rule_on_item(item);\n\t\telse\n\t\t\titem.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\n\t\t\t\tprecision(\"rate\", item));\n\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tmargin_rate_or_amount: function(doc, cdt, cdn) {\n\t\t// calculated the revised total margin and rate on margin rate changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.apply_pricing_rule_on_item(item);\n\t\tthis.calculate_taxes_and_totals();\n\t\tcur_frm.refresh_fields();\n\t},\n\n\tmargin_type: function(doc, cdt, cdn) {\n\t\t// calculate the revised total margin and rate on margin type changes\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!item.margin_type) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"margin_rate_or_amount\", 0);\n\t\t} else {\n\t\t\tthis.apply_pricing_rule_on_item(item, doc, cdt, cdn);\n\t\t\tthis.calculate_taxes_and_totals();\n\t\t\tcur_frm.refresh_fields();\n\t\t}\n\t},\n\n\tget_incoming_rate: function(item, posting_date, posting_time, voucher_type, company) {\n\n\t\tlet item_args = {\n\t\t\t'item_code': item.item_code,\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\n\t\t\t'posting_date': posting_date,\n\t\t\t'posting_time': posting_time,\n\t\t\t'qty': item.qty * item.conversion_factor,\n\t\t\t'serial_no': item.serial_no,\n\t\t\t'voucher_type': voucher_type,\n\t\t\t'company': company,\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\n\t\t\targs: {\n\t\t\t\targs: item_args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message * item.conversion_factor);\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_taxes_from_item_tax_template: function(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif (item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif (typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif (!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tserial_no: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.doctype === 'Purchase Receipt Item Supplied') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Replace all occurences of comma with line feed\n\t\t\t\titem.serial_no = item.serial_no.replace(/,/g, '\\n');\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif (!doc.is_return && cint(frappe.user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tme.update_qty(cdt, cdn);\n\t\t\t\t\t}, 10000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_qty: function(cdt, cdn) {\n\t\tvar valid_serial_nos = [];\n\t\tvar serialnos = [];\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tserialnos = item.serial_no.split(\"\\n\");\n\t\tfor (var i = 0; i < serialnos.length; i++) {\n\t\t\tif (serialnos[i] != \"\") {\n\t\t\t\tvalid_serial_nos.push(serialnos[i]);\n\t\t\t}\n\t\t}\n\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t},\n\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\n\tupdate_stock: function() {\n\t\tthis.frm.trigger('set_default_internal_warehouse');\n\t},\n\n\tset_default_internal_warehouse: function() {\n\t\tlet me = this;\n\t\tif ((this.frm.doc.doctype === 'Sales Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Delivery Note') {\n\t\t\tif (this.frm.doc.is_internal_customer && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_target_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif ((this.frm.doc.doctype === 'Purchase Invoice' && me.frm.doc.update_stock)\n\t\t\t|| this.frm.doc.doctype == 'Purchase Receipt') {\n\t\t\tif (this.frm.doc.is_internal_supplier && this.frm.doc.company === this.frm.doc.represents_company) {\n\t\t\t\tfrappe.db.get_value('Company', this.frm.doc.company, 'default_in_transit_warehouse', function(value) {\n\t\t\t\t\tme.frm.set_value('set_from_warehouse', value.default_in_transit_warehouse);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tcompany: function() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tselling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\n\t\t\t\t}\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tbuying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)) {\n\t\t\terpnext.utils.get_shipping_address(this.frm, function() {\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t});\n\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t},\n\n\ttransaction_date: function() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t},\n\n\tposting_date: function() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdue_date: function() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = __(\"Please clear the\") + \" \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = __(\"selected Payment Terms Template\");\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = __(\"Payment Schedule Table\");\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tbill_date: function() {\n\t\tthis.posting_date();\n\t},\n\n\trecalculate_terms: function() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\n\tget_company_currency: function() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t},\n\n\tcontact_person: function() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t},\n\n\tcurrency: function() {\n\t\tlet transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\n\t\tlet me = this;\n\t\tthis.set_dynamic_labels();\n\t\tlet company_currency = this.get_company_currency();\n\t\t// Added `ignore_price_list` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list)) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\t// company currency and doc currency is same\n\t\t\t// this will prevent unnecessary conversion rate triggers\n\t\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t} else {\n\t\t\t\tthis.conversion_rate();\n\t\t\t}\n\t\t}\n\t},\n\n\tconversion_rate: function() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t},\n\n\tshipping_rule: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme._calculate_taxes_and_totals();\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t},\n\n\tset_margin_amount_based_on_currency: function(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Purchase Invoice\", \"Purchase Order\", \"Purchase Receipt\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_actual_charges_based_on_currency: function(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.base_tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t},\n\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __(\"Fetching exchange rates ...\"),\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t},\n\n\tprice_list_currency: function() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_price_list` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  &&\n\t\t\t\t!(this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list)) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t},\n\n\tplc_conversion_rate: function() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t},\n\n\tuom: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\titem.pricing_rules = ''\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, 'conversion_factor', r.message.conversion_factor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.calculate_stock_uom_rate(doc, cdt, cdn);\n\t},\n\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\n\t\t\tif(doc.doctype != \"Material Request\") {\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\t\tthis.calculate_net_weight();\n\t\t\t}\n\n\t\t\t// for handling customization not to fetch price list rate\n\t\t\tif(frappe.flags.dont_fetch_price_list_rate) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\n\t\t}\n\t},\n\n\tis_a_mapped_document(item) {\n\t\tconst mapped_item_field_map = {\n\t\t\t\"Delivery Note Item\": [\"si_detail\", \"so_detail\", \"dn_detail\"],\n\t\t\t\"Sales Invoice Item\": [\"dn_detail\", \"so_detail\", \"sales_invoice_item\"],\n\t\t\t\"Purchase Receipt Item\": [\"purchase_order_item\", \"purchase_invoice_item\", \"purchase_receipt_item\"],\n\t\t\t\"Purchase Invoice Item\": [\"purchase_order_item\", \"pr_detail\", \"po_detail\"],\n\t\t};\n\t\tconst mappped_fields = mapped_item_field_map[item.doctype] || [];\n\n\t\treturn mappped_fields\n\t\t\t.map((field) => item[field])\n\t\t\t.filter(Boolean).length > 0;\n\t},\n\n\tbatch_no: function(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tif (!this.is_a_mapped_document(item)) {\n\t\t\tthis.apply_price_list(item, true);\n\t\t}\n\t},\n\n\ttoggle_conversion_factor: function(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t},\n\n\tqty: function(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\titem.pricing_rules = ''\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\n\t\tthis.calculate_stock_uom_rate(doc, cdt, cdn);\n\t\tthis.apply_pricing_rule(item, true);\n\t},\n\n\tcalculate_stock_uom_rate: function(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\titem.stock_uom_rate = flt(item.rate)/flt(item.conversion_factor);\n\t\trefresh_field(\"stock_uom_rate\", item.name, item.parentfield);\n\t},\n\tservice_stop_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tservice_start_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tcalculate_net_weight: function(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t},\n\n\tset_dynamic_labels: function() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tchange_form_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t},\n\n\tchange_grid_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.update_item_grid_labels(company_currency);\n\n\t\tthis.toggle_item_grid_columns(company_currency);\n\n\t\tif (this.frm.doc.operations && this.frm.doc.operations.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.scrap_items && this.frm.doc.scrap_items.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif (this.frm.doc.advances && this.frm.doc.advances.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\tthis.update_payment_schedule_grid_labels(company_currency);\n\t},\n\n\tupdate_item_grid_labels: function(company_currency) {\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\n\t\t\t\"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\n\t\t], company_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\n\t\t\t\"rate\", \"net_rate\", \"price_list_rate\", \"amount\",\n\t\t\t\"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\n\t\t], this.frm.doc.currency, \"items\");\n\t},\n\n\tupdate_payment_schedule_grid_labels: function(company_currency) {\n\t\tconst me = this;\n\t\tif (this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length > 0) {\n\t\t\tthis.frm.set_currency_labels([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"],\n\t\t\t\tcompany_currency, \"payment_schedule\");\n\t\t\tthis.frm.set_currency_labels([\"payment_amount\", \"outstanding\", \"paid_amount\"],\n\t\t\t\tthis.frm.doc.currency, \"payment_schedule\");\n\n\t\t\tvar schedule_grid = this.frm.fields_dict[\"payment_schedule\"].grid;\n\t\t\t$.each([\"base_payment_amount\", \"base_outstanding\", \"base_paid_amount\"], function(i, fname) {\n\t\t\t\tif (frappe.meta.get_docfield(schedule_grid.doctype, fname))\n\t\t\t\t\tschedule_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\t},\n\n\ttoggle_item_grid_columns: function(company_currency) {\n\t\tconst me = this;\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\t},\n\n\trecalculate: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\trecalculate_values: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tcalculate_charges: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tignore_pricing_rule: function() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code && !d.is_free_item) {\n\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\t\"price_list_rate\": d.price_list_rate\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t},\n\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\t// Target doc created from a mapped doc\n\t\tif (this.frm.doc.__onload && this.frm.doc.__onload.ignore_price_list) {\n\t\t\t// Calculate totals even though pricing rule is not applied.\n\t\t\t// `apply_pricing_rule` is triggered due to change in data which most likely contributes to Total.\n\t\t\tif (calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t_get_args: function(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code\n\t\t};\n\t},\n\n\t_get_item_list: function(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"batch_no\": d.batch_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\",  \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\"]), d.doctype) {\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t},\n\n\t_set_values_for_item_list: function(children) {\n\t\tvar me = this;\n\t\tvar items_rule_dict = {};\n\n\t\tfor(var i=0, l=children.length; i<l; i++) {\n\t\t\tvar d = children[i] ;\n\t\t\tlet item_row = frappe.get_doc(d.doctype, d.name);\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rules\");\n\t\t\tfor(var k in d) {\n\t\t\t\tvar v = d[k];\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\n\t\t\t\t\tif(k==\"price_list_rate\") {\n\t\t\t\t\t\titem_row['rate'] = v;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (k !== 'free_item_data') {\n\t\t\t\t\t\titem_row[k] = v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(item_row, [\"price_list_rate\", \"discount_percentage\"]);\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rules) {\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\n\t\t\t} else if(!d.pricing_rules) {\n\t\t\t\tme.remove_pricing_rule(frappe.get_doc(d.doctype, d.name));\n\t\t\t}\n\n\t\t\tif (d.free_item_data.length > 0) {\n\t\t\t\tme.apply_product_discount(d);\n\t\t\t}\n\n\t\t\tif (d.apply_rule_on_other_items) {\n\t\t\t\titems_rule_dict[d.name] = d;\n\t\t\t}\n\t\t}\n\n\t\tme.frm.refresh_field('items');\n\t\tme.apply_rule_on_other_items(items_rule_dict);\n\n\t\tme.calculate_taxes_and_totals();\n\t},\n\n\tapply_rule_on_other_items: function(args) {\n\t\tconst me = this;\n\t\tconst fields = [\"discount_percentage\", \"pricing_rules\", \"discount_amount\", \"rate\"];\n\n\t\tfor(var k in args) {\n\t\t\tlet data = args[k];\n\n\t\t\tif (data && data.apply_rule_on_other_items) {\n\t\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t\tif (in_list(data.apply_rule_on_other_items, d[data.apply_rule_on])) {\n\t\t\t\t\t\tfor(var k in data) {\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'price' || k === 'pricing_rules')) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tapply_product_discount: function(args) {\n\t\tconst items = this.frm.doc.items.filter(d => (d.is_free_item)) || [];\n\n\t\tconst exist_items = items.map(row => (row.item_code, row.pricing_rules));\n\n\t\targs.free_item_data.forEach(pr_row => {\n\t\t\tlet row_to_modify = {};\n\t\t\tif (!items || !in_list(exist_items, (pr_row.item_code, pr_row.pricing_rules))) {\n\n\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc,\n\t\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\n\n\t\t\t} else if(items) {\n\t\t\t\trow_to_modify = items.filter(d => (d.item_code === pr_row.item_code\n\t\t\t\t\t&& d.pricing_rules === pr_row.pricing_rules))[0];\n\t\t\t}\n\n\t\t\tfor (let key in pr_row) {\n\t\t\t\trow_to_modify[key] = pr_row[key];\n\t\t\t}\n\t\t});\n\n\t\t// free_item_data is a temporary variable\n\t\targs.free_item_data = '';\n\t\trefresh_field('items');\n\t},\n\n\tapply_price_list: function(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t},\n\n\tremove_pricing_rule: function(item) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\",\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\n\n\t\tif(item.remove_free_item) {\n\t\t\tvar items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\n\t\t\t\t\t[\"pricing_rules\", \"margin_type\"].forEach(field => {\n\t\t\t\t\t\tif (row[field]) {\n\t\t\t\t\t\t\trow[field] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t},\n\n\ttrigger_price_list_rate: function() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t},\n\n\tvalidate_company_and_party: function() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t},\n\n\tget_terms: function() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\ttax_category: function() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t},\n\n\tupdate_item_tax_map: function() {\n\t\tlet me = this;\n\t\tlet item_codes = [];\n\t\tlet item_rates = {};\n\t\tlet item_tax_templates = {};\n\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif (item.item_code) {\n\t\t\t\t// Use combination of name and item code in case same item is added multiple times\n\t\t\t\titem_codes.push([item.item_code, item.name]);\n\t\t\t\titem_rates[item.name] = item.net_rate;\n\t\t\t\titem_tax_templates[item.name] = item.item_tax_template;\n\t\t\t}\n\t\t});\n\n\t\tif (item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes,\n\t\t\t\t\titem_rates: item_rates,\n\t\t\t\t\titem_tax_templates: item_tax_templates\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif (item.name && r.message.hasOwnProperty(item.name) && r.message[item.name].item_tax_template) {\n\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.name].item_tax_template;\n\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.name].item_tax_rate;\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\titem_tax_template: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\n\n\tis_recurring: function() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t},\n\n\tfrom_date: function() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t},\n\n\tset_gross_profit: function(item) {\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t},\n\n\tsetup_item_selector: function() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t},\n\n\tget_advances: function() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tmake_payment_entry: function() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_quality_inspection: function () {\n\t\tlet data = [];\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tfieldname: \"items\",\n\t\t\t\tcannot_add_rows: true,\n\t\t\t\tin_place_edit: true,\n\t\t\t\tdata: data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"docname\",\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_code\",\n\t\t\t\t\t\tlabel: __(\"Item Code\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Read Only\",\n\t\t\t\t\t\tfieldname: \"item_name\",\n\t\t\t\t\t\tlabel: __(\"Item Name\"),\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\t\tlabel: __(\"Accepted Quantity\"),\n\t\t\t\t\t\tin_list_view: true,\n\t\t\t\t\t\tread_only: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tfieldname: \"sample_size\",\n\t\t\t\t\t\tlabel: __(\"Sample Size\"),\n\t\t\t\t\t\treqd: true,\n\t\t\t\t\t\tin_list_view: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"description\",\n\t\t\t\t\t\tlabel: __(\"Description\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"serial_no\",\n\t\t\t\t\t\tlabel: __(\"Serial No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tfieldname: \"batch_no\",\n\t\t\t\t\t\tlabel: __(\"Batch No\"),\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tconst me = this;\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Select Items for Quality Inspection\"),\n\t\t\tfields: fields,\n\t\t\tprimary_action: function () {\n\t\t\t\tconst data = dialog.get_values();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"erpnext.controllers.stock_controller.make_quality_inspections\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\tdocname: me.frm.doc.name,\n\t\t\t\t\t\titems: data.items\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message.length > 0) {\n\t\t\t\t\t\t\tif (r.message.length === 1) {\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"Quality Inspection\", r.message[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\t\t\t\t\t\"reference_name\": me.frm.doc.name\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tfrappe.set_route(\"List\", \"Quality Inspection\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Create\")\n\t\t});\n\n\t\tthis.frm.doc.items.forEach(item => {\n\t\t\tif (!item.quality_inspection) {\n\t\t\t\tlet dialog_items = dialog.fields_dict.items;\n\t\t\t\tdialog_items.df.data.push({\n\t\t\t\t\t\"docname\": item.name,\n\t\t\t\t\t\"item_code\": item.item_code,\n\t\t\t\t\t\"item_name\": item.item_name,\n\t\t\t\t\t\"qty\": item.qty,\n\t\t\t\t\t\"description\": item.description,\n\t\t\t\t\t\"serial_no\": item.serial_no,\n\t\t\t\t\t\"batch_no\": item.batch_no,\n\t\t\t\t\t\"sample_size\": item.sample_quantity\n\t\t\t\t});\n\t\t\t\tdialog_items.grid.refresh();\n\t\t\t}\n\t\t});\n\n\t\tdata = dialog.fields_dict.items.df.data;\n\t\tif (!data.length) {\n\t\t\tfrappe.msgprint(__(\"All items in this document already have a linked Quality Inspection.\"));\n\t\t} else {\n\t\t\tdialog.show();\n\t\t}\n\t},\n\n\tget_method_for_payment: function(){\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t},\n\n\tset_query_for_batch: function(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\n\t\t\tif (doc.is_return) {\n\t\t\t\tfilters[\"is_return\"] = 1;\n\t\t\t}\n\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tset_query_for_item_tax_template: function(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\treturn doc.company ? {filters: {company: doc.company}} : {};\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tpayment_terms_template: function() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbase_grand_total: doc.base_rounded_total || doc.base_grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tpayment_term: function(doc, cdt, cdn) {\n\t\tconst me = this;\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total,\n\t\t\t\t\tbase_grand_total: this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t\tconst company_currency = me.get_company_currency();\n\t\t\t\t\t\t\tme.update_payment_schedule_grid_labels(company_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tagainst_blanket_order: function(doc, cdt, cdn) {\n\t\tvar item = locals[cdt][cdn];\n\t\tif(!item.against_blanket_order) {\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\n\t\t}\n\t},\n\n\tblanket_order: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tset_reserve_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\n\t},\n\n\tset_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\n\t},\n\n\tset_target_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"target_warehouse\", this.frm.doc.set_target_warehouse);\n\t},\n\n\tset_from_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"from_warehouse\", this.frm.doc.set_from_warehouse);\n\t},\n\n\tautofill_warehouse : function (child_table, warehouse_field, warehouse) {\n\t\tif (warehouse && child_table && child_table.length) {\n\t\t\tlet doctype = child_table[0].doctype;\n\t\t\t$.each(child_table || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n\t\t\t});\n\t\t}\n\t},\n\n\tcoupon_code: function() {\n\t\tif (this.frm.doc.coupon_code || this.frm._last_coupon_code) {\n\t\t\t// reset pricing rules if coupon code is set or is unset\n\t\t\tconst _ignore_pricing_rule = this.frm.doc.ignore_pricing_rule;\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\n\t\t\t\t() => this.frm.trigger('ignore_pricing_rule'),\n\t\t\t\t() => this.frm.doc.ignore_pricing_rule=_ignore_pricing_rule,\n\t\t\t\t() => this.frm.trigger('apply_pricing_rule'),\n\t\t\t\t() => this.frm._last_coupon_code = this.frm.doc.coupon_code\n\t\t\t]);\n\t\t}\n\t}\n});\n\nerpnext.show_serial_batch_selector = function (frm, d, callback, on_close, show_dialog) {\n\tlet warehouse, receiving_stock, existing_stock;\n\tif (frm.doc.is_return) {\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\n\t\t\treceiving_stock = true;\n\t\t}\n\t} else {\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\n\t\t\t\treceiving_stock = true;\n\t\t\t} else {\n\t\t\t\texisting_stock = true;\n\t\t\t\twarehouse = d.s_warehouse;\n\t\t\t}\n\t\t} else {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t}\n\t}\n\n\tif (!warehouse) {\n\t\tif (receiving_stock) {\n\t\t\twarehouse = [\"like\", \"\"];\n\t\t} else if (existing_stock) {\n\t\t\twarehouse = [\"!=\", \"\"];\n\t\t}\n\t}\n\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n\nerpnext.apply_putaway_rule = (frm, purpose=null) => {\n\tif (!frm.doc.company) {\n\t\tfrappe.throw({message: __(\"Please select a Company first.\"), title: __(\"Mandatory\")});\n\t}\n\tif (!frm.doc.items.length) return;\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.stock.doctype.putaway_rule.putaway_rule.apply_putaway_rule\",\n\t\targs: {\n\t\t\tdoctype: frm.doctype,\n\t\t\titems: frm.doc.items,\n\t\t\tcompany: frm.doc.company,\n\t\t\tsync: true,\n\t\t\tpurpose: purpose\n\t\t},\n\t\tcallback: (result) => {\n\t\t\tif (!result.exc && result.message) {\n\t\t\t\tfrm.clear_table(\"items\");\n\n\t\t\t\tlet items =  result.message;\n\t\t\t\titems.forEach((row) => {\n\t\t\t\t\tdelete row[\"name\"]; // dont overwrite name from server side\n\t\t\t\t\tlet child = frm.add_child(\"items\");\n\t\t\t\t\tObject.assign(child, row);\n\t\t\t\t\tfrm.script_manager.trigger(\"qty\", child.doctype, child.name);\n\t\t\t\t});\n\t\t\t\tfrm.get_field(\"items\").grid.refresh();\n\t\t\t}\n\t\t}\n\t});\n};\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});\n","frappe.provide(\"frappe.help.help_links\");\n\nconst docsUrl = \"https://erpnext.com/docs/\";\n\nfrappe.help.help_links[\"Form/Rename Tool\"] = [\n\t{\n\t\tlabel: \"Bulk Rename\",\n\t\turl: docsUrl + \"user/manual/en/using-erpnext/articles/bulk-rename\",\n\t},\n];\n\n//Setup\n\nfrappe.help.help_links[\"List/User\"] = [\n\t{\n\t\tlabel: \"New User\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/adding-users\",\n\t},\n\t{\n\t\tlabel: \"Rename User\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/rename-user\",\n\t},\n];\n\nfrappe.help.help_links[\"permission-manager\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n\t{\n\t\tlabel: \"Managing Perm Level in Permissions Manager\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/managing-perm-level\",\n\t},\n\t{\n\t\tlabel: \"User Permissions\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/user-permissions\",\n\t},\n\t{\n\t\tlabel: \"Sharing\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/setting-up/users-and-permissions/sharing\",\n\t},\n\t{\n\t\tlabel: \"Password\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/articles/change-password\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/System Settings\"] = [\n\t{\n\t\tlabel: \"System Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/system-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Data Import\"] = [\n\t{\n\t\tlabel: \"Importing and Exporting Data\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/data/data-import\",\n\t},\n\t{\n\t\tlabel: \"Overwriting Data from Data Import Tool\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool\",\n\t},\n];\n\nfrappe.help.help_links[\"module_setup\"] = [\n\t{\n\t\tlabel: \"Role Permissions Manager\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/users-and-permissions/role-based-permissions\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Naming Series\"] = [\n\t{\n\t\tlabel: \"Naming Series\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/naming-series\",\n\t},\n\t{\n\t\tlabel: \"Setting the Current Value for Naming Series\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/naming-series-current-value\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Global Defaults\"] = [\n\t{\n\t\tlabel: \"Global Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/settings/global-defaults\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Heading\"] = [\n\t{\n\t\tlabel: \"Print Heading\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-headings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Letter Head\"] = [\n\t{\n\t\tlabel: \"Letter Head\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/letter-head\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Address Template\"] = [\n\t{\n\t\tlabel: \"Address Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/address-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Terms and Conditions\"] = [\n\t{\n\t\tlabel: \"Terms and Conditions\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/terms-and-conditions\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Cheque Print Template\"] = [\n\t{\n\t\tlabel: \"Cheque Print Template\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/cheque-print-template\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Email Account\"] = [\n\t{\n\t\tlabel: \"Email Account\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-account\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Notification\"] = [\n\t{\n\t\tlabel: \"Notification\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/notifications\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Email Digest\"] = [\n\t{\n\t\tlabel: \"Email Digest\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/email-digest\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Auto Email Report\"] = [\n\t{\n\t\tlabel: \"Auto Email Reports\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/email/auto-email-reports\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Print Settings\"] = [\n\t{\n\t\tlabel: \"Print Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"print-format-builder\"] = [\n\t{\n\t\tlabel: \"Print Format Builder\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/print/print-format-builder\",\n\t},\n];\n\n//setup-integrations\n\nfrappe.help.help_links[\"Form/PayPal Settings\"] = [\n\t{\n\t\tlabel: \"PayPal Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/paypal-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Razorpay Settings\"] = [\n\t{\n\t\tlabel: \"Razorpay Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/razorpay-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Dropbox Settings\"] = [\n\t{\n\t\tlabel: \"Dropbox Settings\",\n\t\turl: docsUrl + \"user/manual/en/erpnext_integration/dropbox-backup\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/LDAP Settings\"] = [\n\t{\n\t\tlabel: \"LDAP Settings\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/erpnext_integration/ldap-integration\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stripe Settings\"] = [\n\t{\n\t\tlabel: \"Stripe Settings\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/erpnext_integration/stripe-integration\",\n\t},\n];\n\n//Sales\n\nfrappe.help.help_links[\"Form/Quotation\"] = [\n\t{ label: \"Quotation\", url: docsUrl + \"user/manual/en/selling/quotation\" },\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Customer\"] = [\n\t{ label: \"Customer\", url: docsUrl + \"user/manual/en/CRM/customer\" },\n\t{\n\t\tlabel: \"Credit Limit\",\n\t\turl: docsUrl + \"user/manual/en/accounts/credit-limit\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Order\"] = [\n\t{\n\t\tlabel: \"Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/sales-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Applying Discount\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/applying-discount\",\n\t},\n\t{\n\t\tlabel: \"Drop Shipping\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/drop-shipping\",\n\t},\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n\t{\n\t\tlabel: \"Close Sales Order\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/close-sales-order\",\n\t},\n\t{\n\t\tlabel: \"Applying Margin\",\n\t\turl: docsUrl + \"user/manual/en/selling/articles/adding-margin\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Product Bundle\"] = [\n\t{\n\t\tlabel: \"Product Bundle\",\n\t\turl: docsUrl + \"user/manual/en/selling/product-bundle\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Selling Settings\"] = [\n\t{\n\t\tlabel: \"Selling Settings\",\n\t\turl: docsUrl + \"user/manual/en/selling/selling-settings\",\n\t},\n];\n\n//Buying\n\nfrappe.help.help_links[\"List/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Supplier\"] = [\n\t{ label: \"Supplier\", url: docsUrl + \"user/manual/en/buying/supplier\" },\n];\n\nfrappe.help.help_links[\"Form/Request for Quotation\"] = [\n\t{\n\t\tlabel: \"Request for Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/request-for-quotation\",\n\t},\n\t{\n\t\tlabel: \"RFQ Video\",\n\t\turl: docsUrl + \"user/videos/learn/request-for-quotation.html\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Supplier Quotation\"] = [\n\t{\n\t\tlabel: \"Supplier Quotation\",\n\t\turl: docsUrl + \"user/manual/en/buying/supplier-quotation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Buying Settings\"] = [\n\t{\n\t\tlabel: \"Buying Settings\",\n\t\turl: docsUrl + \"user/manual/en/buying/setup/buying-settings\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Purchase Order\"] = [\n\t{\n\t\tlabel: \"Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/buying/purchase-order\",\n\t},\n\t{\n\t\tlabel: \"Item UoM\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/purchasing-in-different-unit\",\n\t},\n\t{\n\t\tlabel: \"Supplier Item Code\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Order\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Taxes and Charges Template\"] = [\n\t{\n\t\tlabel: \"Setting Up Taxes\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/setting-up-taxes\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Price List\"] = [\n\t{\n\t\tlabel: \"Price List\",\n\t\turl: docsUrl + \"user/manual/en/stock/price-lists\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Authorization Rule\"] = [\n\t{\n\t\tlabel: \"Authorization Rule\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/authorization-rule\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/SMS Settings\"] = [\n\t{\n\t\tlabel: \"SMS Settings\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/sms-setting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Stock Reconciliation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Territory\"] = [\n\t{\n\t\tlabel: \"Territory\",\n\t\turl: docsUrl + \"user/manual/en/selling/territory\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Workflow\"] = [\n\t{ label: \"Workflow\", url: docsUrl + \"user/manual/en/setting-up/workflows\" },\n];\n\nfrappe.help.help_links[\"List/Company\"] = [\n\t{\n\t\tlabel: \"Company\",\n\t\turl: docsUrl + \"user/manual/en/setting-up/company-setup\",\n\t},\n\t{\n\t\tlabel: \"Delete All Related Transactions for a Company\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions\",\n\t},\n];\n\n//Accounts\n\nfrappe.help.help_links[\"Tree/Account\"] = [\n\t{\n\t\tlabel: \"Chart of Accounts\",\n\t\turl: docsUrl + \"user/manual/en/accounts/chart-of-accounts\",\n\t},\n\t{\n\t\tlabel: \"Managing Tree Mastes\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/setting-up/articles/managing-tree-structure-masters\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Sales Invoice\"] = [\n\t{\n\t\tlabel: \"Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/sales-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balances\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Recurring Sales Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"point-of-sale\"] = [\n\t{\n\t\tlabel: \"Point of Sale Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/point-of-sales\",\n\t},\n];\n\nfrappe.help.help_links[\"List/POS Profile\"] = [\n\t{\n\t\tlabel: \"Point of Sale Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/POS Profile\"] = [\n\t{\n\t\tlabel: \"POS Profile\",\n\t\turl: docsUrl + \"user/manual/en/accounts/pos-profile\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Invoice\"] = [\n\t{\n\t\tlabel: \"Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/purchase-invoice\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n\t{\n\t\tlabel: \"Recurring Purchase Invoice\",\n\t\turl: docsUrl + \"user/manual/en/accounts/articles/recurring-orders-and-invoices\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Journal Entry\"] = [\n\t{\n\t\tlabel: \"Journal Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/journal-entry\",\n\t},\n\t{\n\t\tlabel: \"Advance Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/advance-payment-entry\",\n\t},\n\t{\n\t\tlabel: \"Accounts Opening Balance\",\n\t\turl: docsUrl + \"user/manual/en/accounts/opening-balance\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Entry\"] = [\n\t{\n\t\tlabel: \"Payment Entry\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-entry\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Payment Request\"] = [\n\t{\n\t\tlabel: \"Payment Request\",\n\t\turl: docsUrl + \"user/manual/en/accounts/payment-request\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset\"] = [\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Asset Category\"] = [\n\t{\n\t\tlabel: \"Asset Category\",\n\t\turl: docsUrl + \"user/manual/en/asset/asset-category\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Cost Center\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\n//Stock\n\nfrappe.help.help_links[\"List/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item\"] = [\n\t{ label: \"Item\", url: docsUrl + \"user/manual/en/stock/item\" },\n\t{\n\t\tlabel: \"Item Price\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-price\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Item Wise Taxation\",\n\t\turl: docsUrl + \"user/manual/en/accounts/item-tax-template\",\n\t},\n\t{\n\t\tlabel: \"Managing Fixed Assets\",\n\t\turl: docsUrl + \"user/manual/en/asset\",\n\t},\n\t{\n\t\tlabel: \"Item Codification\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/item-codification\",\n\t},\n\t{\n\t\tlabel: \"Item Variants\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-variants\",\n\t},\n\t{\n\t\tlabel: \"Item Valuation\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/item/item-valuation-fifo-and-moving-average\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Purchase Receipt\"] = [\n\t{\n\t\tlabel: \"Purchase Receipt\",\n\t\turl: docsUrl + \"user/manual/en/stock/purchase-receipt\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Delivery Note\"] = [\n\t{\n\t\tlabel: \"Delivery Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/delivery-note\",\n\t},\n\t{\n\t\tlabel: \"Sales Return\",\n\t\turl: docsUrl + \"user/manual/en/stock/sales-return\",\n\t},\n\t{\n\t\tlabel: \"Barcode\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/track-items-using-barcode\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Installation Note\"] = [\n\t{\n\t\tlabel: \"Installation Note\",\n\t\turl: docsUrl + \"user/manual/en/stock/installation-note\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Budget\"] = [\n\t{ label: \"Budgeting\", url: docsUrl + \"user/manual/en/accounts/budgeting\" },\n];\n\nfrappe.help.help_links[\"List/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Material Request\"] = [\n\t{\n\t\tlabel: \"Material Request\",\n\t\turl: docsUrl + \"user/manual/en/stock/material-request\",\n\t},\n\t{\n\t\tlabel: \"Auto-creation of Material Request\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/stock/articles/auto-creation-of-material-request\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n\t{\n\t\tlabel: \"Stock Entry Types\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/stock-entry-purpose\",\n\t},\n\t{\n\t\tlabel: \"Repack Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/articles/repack-entry\",\n\t},\n\t{\n\t\tlabel: \"Opening Stock\",\n\t\turl: docsUrl + \"user/manual/en/stock/opening-stock\",\n\t},\n\t{\n\t\tlabel: \"Subcontracting\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/subcontracting\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Stock Entry\"] = [\n\t{ label: \"Stock Entry\", url: docsUrl + \"user/manual/en/stock/stock-entry\" },\n];\n\nfrappe.help.help_links[\"Tree/Warehouse\"] = [\n\t{ label: \"Warehouse\", url: docsUrl + \"user/manual/en/stock/warehouse\" },\n];\n\nfrappe.help.help_links[\"List/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"Form/Serial No\"] = [\n\t{ label: \"Serial No\", url: docsUrl + \"user/manual/en/stock/serial-no\" },\n];\n\nfrappe.help.help_links[\"List/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Batch\"] = [\n\t{ label: \"Batch\", url: docsUrl + \"user/manual/en/stock/batch\" },\n];\n\nfrappe.help.help_links[\"Form/Packing Slip\"] = [\n\t{\n\t\tlabel: \"Packing Slip\",\n\t\turl: docsUrl + \"user/manual/en/stock/packing-slip\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Quality Inspection\"] = [\n\t{\n\t\tlabel: \"Quality Inspection\",\n\t\turl: docsUrl + \"user/manual/en/stock/quality-inspection\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Landed Cost Voucher\"] = [\n\t{\n\t\tlabel: \"Landed Cost Voucher\",\n\t\turl: docsUrl + \"user/manual/en/stock/landed-cost-voucher\",\n\t},\n];\n\nfrappe.help.help_links[\"Tree/Item Group\"] = [\n\t{\n\t\tlabel: \"Item Group\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-group\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Item Attribute\"] = [\n\t{\n\t\tlabel: \"Item Attribute\",\n\t\turl: docsUrl + \"user/manual/en/stock/item-attribute\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/UOM\"] = [\n\t{\n\t\tlabel: \"Fractions in UOM\",\n\t\turl:\n\t\t\tdocsUrl + \"user/manual/en/stock/articles/managing-fractions-in-uom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Stock Reconciliation\"] = [\n\t{\n\t\tlabel: \"Opening Stock Entry\",\n\t\turl: docsUrl + \"user/manual/en/stock/stock-reconciliation\",\n\t},\n];\n\n//CRM\n\nfrappe.help.help_links[\"Form/Lead\"] = [\n\t{ label: \"Lead\", url: docsUrl + \"user/manual/en/CRM/lead\" },\n];\n\nfrappe.help.help_links[\"Form/Opportunity\"] = [\n\t{ label: \"Opportunity\", url: docsUrl + \"user/manual/en/CRM/opportunity\" },\n];\n\nfrappe.help.help_links[\"Form/Address\"] = [\n\t{ label: \"Address\", url: docsUrl + \"user/manual/en/CRM/address\" },\n];\n\nfrappe.help.help_links[\"Form/Contact\"] = [\n\t{ label: \"Contact\", url: docsUrl + \"user/manual/en/CRM/contact\" },\n];\n\nfrappe.help.help_links[\"Form/Newsletter\"] = [\n\t{ label: \"Newsletter\", url: docsUrl + \"user/manual/en/CRM/newsletter\" },\n];\n\nfrappe.help.help_links[\"Form/Campaign\"] = [\n\t{ label: \"Campaign\", url: docsUrl + \"user/manual/en/CRM/campaign\" },\n];\n\nfrappe.help.help_links[\"Tree/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person\",\n\t\turl: docsUrl + \"user/manual/en/CRM/sales-person\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Sales Person\"] = [\n\t{\n\t\tlabel: \"Sales Person Target\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/sales-person-target-allocation\",\n\t},\n\t{\n\t\tlabel: \"Sales Person in Transactions\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/selling/articles/sales-persons-in-the-sales-transactions\",\n\t},\n];\n\n//Manufacturing\n\nfrappe.help.help_links[\"Form/BOM\"] = [\n\t{\n\t\tlabel: \"Bill of Material\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bill-of-materials\",\n\t},\n\t{\n\t\tlabel: \"Nested BOM Structure\",\n\t\turl:\n\t\t\tdocsUrl +\n\t\t\t\"user/manual/en/manufacturing/articles/managing-multi-level-bom\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Work Order\"] = [\n\t{\n\t\tlabel: \"Work Order\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/work-order\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Workstation\"] = [\n\t{\n\t\tlabel: \"Workstation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/workstation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Operation\"] = [\n\t{\n\t\tlabel: \"Operation\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/operation\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/BOM Update Tool\"] = [\n\t{\n\t\tlabel: \"BOM Update Tool\",\n\t\turl: docsUrl + \"user/manual/en/manufacturing/bom-update-tool\",\n\t},\n];\n\n//Customize\n\nfrappe.help.help_links[\"Form/Customize Form\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n\t{\n\t\tlabel: \"Customize Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/customize-form\",\n\t},\n];\n\nfrappe.help.help_links[\"List/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n\nfrappe.help.help_links[\"Form/Custom Field\"] = [\n\t{\n\t\tlabel: \"Custom Field\",\n\t\turl: docsUrl + \"user/manual/en/customize-erpnext/custom-field\",\n\t},\n];\n","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis.check_naming_series_based_on();\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tcheck_naming_series_based_on: function() {\n\t\tif (frappe.defaults.get_default(\"item_naming_by\") === \"Naming Series\") {\n\t\t\tthis.mandatory = this.mandatory.filter(d => d.fieldname !== \"item_code\");\n\t\t}\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert, init_callback, doc, force) {\n\t\tthis._super(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.SupplierQuickEntryForm = class SupplierQuickEntryForm extends frappe.ui.form.QuickEntryForm {\n\tconstructor(doctype, after_insert, init_callback, doc, force) {\n\t\tsuper(doctype, after_insert, init_callback, doc, force);\n\t\tthis.skip_redirect_on_error = true;\n\t}\n\n\trender_dialog() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tsuper.render_dialog();\n\t}\n\n\tget_variant_fields() {\n\t\tvar variant_fields = [\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\t\tcollapsible: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Email Id\"),\n\t\t\t\tfieldname: \"email_id\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\t\tfieldname: \"mobile_no\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\t\tcollapsible: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\t\tfieldname: \"address_line1\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\t\tfieldname: \"address_line2\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\t\tfieldname: \"pincode\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Column Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"City\"),\n\t\t\t\tfieldname: \"city\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"State\"),\n\t\t\t\tfieldname: \"state\",\n\t\t\t\tfieldtype: \"Data\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Country\"),\n\t\t\t\tfieldname: \"country\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Country\"\n\t\t\t}\n\t\t];\n\n\t\treturn variant_fields;\n\t}\n};\n","frappe.provide('erpnext.hub');\n\nfrappe.views.MarketplaceFactory = class MarketplaceFactory extends frappe.views.Factory {\n\tshow() {\n\t\tis_marketplace_disabled()\n\t\t\t.then(disabled => {\n\t\t\t\tif (disabled) {\n\t\t\t\t\tfrappe.show_not_found('Marketplace');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (frappe.pages.marketplace) {\n\t\t\t\t\tfrappe.container.change_to('marketplace');\n\t\t\t\t\terpnext.hub.marketplace.refresh();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make('marketplace');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tmake(page_name) {\n\t\tconst assets = [\n\t\t\t'/assets/js/marketplace.min.js'\n\t\t];\n\n\t\tfrappe.require(assets, () => {\n\t\t\terpnext.hub.marketplace = new erpnext.hub.Marketplace({\n\t\t\t\tparent: this.make_page(true, page_name)\n\t\t\t});\n\t\t});\n\t}\n};\n\nfunction is_marketplace_disabled() {\n\treturn frappe.call({\n\t\tmethod: \"erpnext.hub_node.doctype.marketplace_settings.marketplace_settings.is_marketplace_enabled\"\n\t}).then(r => r.message)\n}\n","class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true\n\t\t});\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.setup_dialog();\n\t\tthis.set_call_status();\n\t\tfrappe.utils.bind_actions_with_object(this.dialog.$body, this);\n\t\tthis.dialog.$wrapper.addClass('call-popup');\n\t\tthis.dialog.get_close_btn().unbind('click').click(this.close_modal.bind(this));\n\t\tthis.dialog.show();\n\t}\n\n\tsetup_dialog() {\n\t\tthis.setup_call_details();\n\t\tthis.dialog.$body.empty().append(this.caller_info);\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('green');\n\t\t} else if (['No Answer', 'Missed'].includes(call_status)) {\n\t\t\tthis.set_indicator('yellow');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Busy', 'Failed'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Ended');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log, missed) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status(missed ? 'Missed': null);\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_ended(call_log, missed) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log, missed);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 60000);\n\t\tthis.clear_listeners();\n\t}\n\n\tget_caller_name() {\n\t\tconst contact_link = this.get_contact_link();\n\t\treturn contact_link.link_title || contact_link.link_name;\n\t}\n\n\tget_contact_link() {\n\t\tlet log = this.call_log;\n\t\tlet contact_link = log.links.find(d => d.link_doctype === 'Contact');\n\t\treturn contact_link || {};\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_ended`, call_log => {\n\t\t\tthis.call_ended(call_log);\n\t\t});\n\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_missed`, call_log => {\n\t\t\tthis.call_ended(call_log, true);\n\t\t});\n\t}\n\n\tclear_listeners() {\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_ended`);\n\t\tfrappe.realtime.off(`call_${this.call_log.id}_missed`);\n\t}\n\n\tsetup_call_details() {\n\t\tthis.caller_info = $(`<div></div>`);\n\t\tthis.call_details = new frappe.ui.FieldGroup({\n\t\t\tfields: [{\n\t\t\t\t'fieldname': 'name',\n\t\t\t\t'label': 'Name',\n\t\t\t\t'default': this.get_caller_name() || __('Unknown Caller'),\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Contact'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Contact', this.get_contact_link().link_name),\n\t\t\t\t'depends_on': () => this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Contact'),\n\t\t\t\t'click': this.create_new_contact.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Customer'),\n\t\t\t\t'click': this.create_new_customer.bind(this),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Lead'),\n\t\t\t\t'click': () => frappe.new_doc('Lead', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldname': 'number',\n\t\t\t\t'label': 'Phone Number',\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'default': this.caller_number,\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldname': 'call_type',\n\t\t\t\t'label': 'Call Type',\n\t\t\t\t'fieldtype': 'Link',\n\t\t\t\t'options': 'Telephony Call Type',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'hide_border': 1,\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.call_details.get_value('call_summary');\n\t\t\t\t\tconst call_type = this.call_details.get_value('call_type');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('erpnext.telephony.doctype.call_log.call_log.add_call_summary_and_call_type', {\n\t\t\t\t\t\t'call_log': this.call_log.name,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t\t'call_type': call_type,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__('Call Summary Saved')}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"/app/call-log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__('View call log')}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t\tbody: this.caller_info\n\t\t});\n\t\tthis.call_details.make();\n\t}\n\n\tis_known_caller() {\n\t\treturn Boolean(this.get_caller_name());\n\t}\n\n\tcreate_new_customer() {\n\t\t// to avoid quick entry form\n\t\tconst new_customer = frappe.model.get_new_doc('Customer');\n\t\tnew_customer.mobile_no = this.caller_number;\n\t\tfrappe.set_route('Form', new_customer.doctype, new_customer.name);\n\t}\n\n\tcreate_new_contact() {\n\t\t// TODO: fix new_doc, it should accept child table values\n\t\tconst new_contact = frappe.model.get_new_doc('Contact');\n\t\tconst phone_no = frappe.model.add_child(new_contact, 'Contact Phone', 'phone_nos');\n\t\tphone_no.phone = this.caller_number;\n\t\tphone_no.is_primary_mobile_no = 1;\n\t\tfrappe.set_route('Form', new_contact.doctype, new_contact.name);\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tlet call_popup = erpnext.call_popup;\n\t\tif (call_popup && call_log.name === call_popup.call_log.name) {\n\t\t\tcall_popup.update_call_log(call_log);\n\t\t\tcall_popup.dialog.show();\n\t\t} else {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t}\n\t});\n});\n\nwindow.CallPopup = CallPopup;\n","frappe.provide('erpnext.accounts');\n\nerpnext.accounts.dimensions = {\n\tsetup_dimension_filters(frm, doctype) {\n\t\tthis.accounting_dimensions = [];\n\t\tthis.default_dimensions = {};\n\t\tthis.fetch_custom_dimensions(frm, doctype);\n\t},\n\n\tfetch_custom_dimensions(frm, doctype) {\n\t\tlet me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions\",\n\t\t\targs: {\n\t\t\t\t'with_cost_center_and_project': true\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.accounting_dimensions = r.message[0];\n\t\t\t\tme.default_dimensions = r.message[1];\n\t\t\t\tme.setup_filters(frm, doctype);\n\t\t\t}\n\t\t});\n\t},\n\n\tsetup_filters(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension['document_type'], () => {\n\t\t\t\t\tlet parent_fields = [];\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\t\tparent_fields.push(df.fieldname);\n\t\t\t\t\t\t} else if (df.fieldtype === 'Table') {\n\t\t\t\t\t\t\tthis.setup_child_filters(frm, df.options, df.fieldname, dimension['fieldname']);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\tthis.setup_account_filters(frm, dimension['fieldname'], parent_fields);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_child_filters(frm, doctype, parentfield, dimension) {\n\t\tlet fields = [];\n\n\t\tif (frappe.meta.has_field(doctype, dimension)) {\n\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\tfrappe.meta.get_docfields(doctype).forEach((df) => {\n\t\t\t\t\tif (df.fieldtype === 'Link' && df.options === 'Account') {\n\t\t\t\t\t\tfields.push(df.fieldname);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrm.set_query(dimension, parentfield, function(doc, cdt, cdn) {\n\t\t\t\t\tlet row = locals[cdt][cdn];\n\t\t\t\t\treturn erpnext.queries.get_filtered_dimensions(row, fields, dimension, doc.company);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_account_filters(frm, dimension, fields) {\n\t\tfrm.set_query(dimension, function(doc) {\n\t\t\treturn erpnext.queries.get_filtered_dimensions(doc, fields, dimension, doc.company);\n\t\t});\n\t},\n\n\tupdate_dimension(frm, doctype) {\n\t\tif (this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tif (frm.is_new()) {\n\t\t\t\t\tif (frm.doc.company && Object.keys(this.default_dimensions || {}).length > 0\n\t\t\t\t\t\t&& this.default_dimensions[frm.doc.company]) {\n\n\t\t\t\t\t\tlet default_dimension = this.default_dimensions[frm.doc.company][dimension['fieldname']];\n\n\t\t\t\t\t\tif (default_dimension) {\n\t\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\t\tfrm.set_value(dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.each(frm.doc.items || frm.doc.accounts || [], function(i, row) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcopy_dimension_from_first_row(frm, cdt, cdn, fieldname) {\n\t\tif (frappe.meta.has_field(frm.doctype, fieldname) && this.accounting_dimensions) {\n\t\t\tthis.accounting_dimensions.forEach((dimension) => {\n\t\t\t\tlet row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(fieldname, row, [dimension['fieldname']]);\n\t\t\t});\n\t\t}\n\t}\n};\n","frappe.ui.form.ControlData = frappe.ui.form.ControlData.extend( {\n\tmake_input() {\n\t\tthis._super();\n\t\tif (this.df.options == 'Phone') {\n\t\t\tthis.setup_phone();\n\t\t}\n\t\tif (this.frm && this.frm.fields_dict) {\n\t\t\tObject.values(this.frm.fields_dict).forEach(function(field) {\n\t\t\t\tif (field.df.read_only === 1 && field.df.options === 'Phone'\n\t\t\t\t\t&& field.disp_area.style[0] != 'display' && !field.has_icon) {\n\t\t\t\t\tfield.setup_phone();\n\t\t\t\t\tfield.has_icon = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tsetup_phone() {\n\t\tif (frappe.phone_call.handler) {\n\t\t\tlet control = this.df.read_only ? '.control-value' : '.control-input';\n\t\t\tthis.$wrapper.find(control)\n\t\t\t\t.append(`\n\t\t\t\t\t<span class=\"phone-btn\">\n\t\t\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__('Make a call')}\">\n\t\t\t\t\t\t\t${frappe.utils.icon('call')}\n\t\t\t\t\t</span>\n\t\t\t\t`)\n\t\t\t\t.find('.phone-btn')\n\t\t\t\t.click(() => {\n\t\t\t\t\tfrappe.phone_call.handler(this.get_value(), this.frm);\n\t\t\t\t});\n\t\t}\n\t}\n});\n"],"names":["attach_selector_button","inner_text","append_loction","context","grid_row","let","$btn_div","$","css","margin-bottom","margin-top","appendTo","on","show_serial_batch_selector","frm","doc","frappe","provide","extend","breadcrumbs","preferred","Item Group","Customer Group","Supplier Group","Territory","Sales Person","Sales Partner","Brand","Maintenance Schedule","Maintenance Visit","module_map","ERPNext Integrations","Geo","Portal","Utilities","E-commerce","Contacts","erpnext","get_currency","company","cur_frm","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","const","currency_list","docs","filter","d","doctype","map","name","unshift","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_or_batch_no","open_grid_row","grid_form","serial_no","get_status","model","get_value","item_code","ref","assign","has_serial_no","has_batch_no","__","$wrapper","this","batch_no","route_to_adjustment_jv","args","with_doctype","journal_entry","get_new_doc","accounts","forEach","je_account","child_row","add_child","account","debit_in_account_currency","credit_in_account_currency","party_type","set_route","route_to_pending_reposts","proceed_save_with_reminders_frequency_change","ui","hide_open_dialog","call","method","callback","save","utils","set_party_dashboard_indicators","__onload","dashboard_info","company_wise_info","info","add_indicator_for_multicompany","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","loyalty_points","stats_area","show","stats_area_row","addClass","color","indicator","get_party_name","Customer","Supplier","Employee","Member","copy_value_in_all_rows","dt","dn","table_fieldname","fieldname","cl","i","refresh_field","get_terms","tc_name","template_name","r","make_bank_account","docname","freeze","doclist","sync","message","add_dimensions","report_name","index","filters","query_reports","dimension","some","el","splice","label","fieldtype","get_data","txt","db","get_link_options","make_subscription","make_pricing_rule","first_row_is_empty","child_table","isArray","remove_empty_first_row","child_table_name","rows","get_tree_options","option","unscrub_option","unscrub","user_permission","defaults","get_user_permissions","perm","c","sort","value","self","indexOf","get_tree_default","options","includes","get_default","overrides_parent_value_in_all_rows","parent_fieldname","create_new_doc","update_fields","new_doc","entries","key","form","make_quick_entry","select_alternate_items","opts","warehouse_field","item_field","data","dialog","Dialog","title","fields","cannot_add_rows","in_place_edit","hidden","in_list_view","read_only","default","onchange","warehouse","on_grid_fields_dict","actual_qty","get_query","e","query","primary_action","get_values","alternate_item","row","child_doctype","qty","required_qty","original_item_field","trigger","child_docname","hide","primary_action_label","condition","alternative_items","df","push","grid","refresh","update_child_items","cannot_add_row","child_meta","get_meta","get_precision","find","f","precision","disabled","is_sales_item","is_subcontracted","is_sub_contracted_item","is_purchase_item","reqd","uom","exc","conversion_factor","trans_items","item","parent_doctype","parent_doctype_name","reload_doc","delivery_date","schedule_date","rate","map_current_doc","_map","items","items_doctype","meta","get_docfield","link_fieldname","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","dirty","query_args","get_query_filters","get_query_method","MultiSelectDialog","target","date_field","undefined","setters","add_filters_group","allow_child_item_selection","child_fieldname","child_columns","size","action","selections","values","link_formatters","item_name","employee_name","employee","project_name","project","document","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","company_address_query","is_your_company_address","dispatch_address_query","supplier_filter","lead_filter","not_a_group_filter","is_group","cstr","get_filtered_dimensions","child_fields","field","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","me","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","party_name","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","SALES_DOCTYPES","PURCHASE_DOCTYPES","get_party_details","quotation_to","party","price_list","selling_price_list","bill_date","buying_price_list","posting_date","transaction_date","fetch_payment_terms_template","ignore_default_payment_terms_template","company_address","billing_address","shipping_address","validate_mandatory","supplier_tds","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","get_address_display","address_field","display_field","address_dict","set_taxes_from_address","triggered_from_field","billing_address_field","shipping_address_field","tax_category","set_taxes","customer_group","supplier_group","shipping_address_name","get_contact_details","contact_display","contact_email","contact_mobile","contact_phone","contact_designation","contact_department","trigger_on","get_shipping_address","inter_company_order_reference","internal_invoice_reference","internal_order_reference","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","moment","modified","format","show_cancelled_entries","show_general_ledger","group_by","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","click","select","set_primary_action","amount","submit_invoice","empty","html","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","val","conversion_rate","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","attr","update_paid_amount","change","write_off_amount","selected_row","removeClass","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","fetch_round_off_accounts","apply_pricing_rule_on_item","effective_item_rate","price_list_rate","item_rate","parenttype","blanket_order_rate","margin_type","rate_with_margin","margin_rate_or_amount","base_rate_with_margin","discount_percentage","discount_amount","calculate_taxes_and_totals","async","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","apply_discount_on","is_cash_or_non_trade_discount","grand_total","base_grand_total","base_discount_amount","calculate_shipping_charges","is_return","calculate_total_advance","is_pos","set_total_amount_to_default_mop","calculate_paid_amount","calculate_commission","calculate_contribution","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","subs","err_message","round_floats_in","net_rate","is_debit_note","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","tax","dont_recompute_tax","item_wise_tax_detail","tax_fields","charge_type","cscript","validate_taxes_and_charges","validate_inclusive_tax","flags","round_off_applicable_accounts","account_list","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","total_inclusive_tax_amount_per_qty","current_tax_fraction","get_current_tax_fraction","tax_fraction_for_current_item","inclusive_tax_amount_per_qty","grand_total_fraction_for_current_item","tax_rate","_get_tax_rate","row_id","add_deduct_tax","account_head","total_qty","total","base_total","net_total","base_net_total","base_amount","base_net_amount","shipping_rule","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","round_off_base_values","set_cumulative_total","row_idx","JSON","parse","actual","set_item_wise_tax","tax_detail","item_wise_tax_amount","Math","round","base_tax_amount","base_tax_amount_after_discount_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","abs","pow","tax_count","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","write_off_outstanding_amount_automatically","is_internal_invoice","represents_company","party_account_currency","total_amount_to_pay","total_amount_for_payment","redeem_loyalty_points","loyalty_amount","set_default_payment","calculate_change_amount","base_paid_amount","pay","payment_status","base_change_amount","payment_types","TransactionController","_super","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","calculate_stock_uom_rate","tax_table","set_dynamic_labels","via_discount_percentage","then","items_add","set_warehouse","target_warehouse","set_target_warehouse","from_warehouse","set_from_warehouse","dimensions","copy_dimension_from_first_row","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","set_indicator_formatter","batch_no_field","get_route_options_for_new_doc","blanket_order_type","taxes_and_charges","get_user_default","amended_from","return_against","setup_quality_inspection","make_quality_inspection","page","set_inner_btn_group_as_primary","inspection_type","reference_type","reference_name","description","item_serial_no","split","make_payment_request","payment_request_type","recipient_id","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","set_multiple_add","setup_sms","scan_barcode","search_value","modify_table_after_scan","show_alert","scan_barcode_field","cur_grid","row_to_modify","Boolean","get_batch_row_to_modify","get_row_to_modify_on_scan","show_scan_message","set_scanned_values","from_barcode","is_serial_no","existing_item_row","blank_item_row","exist","taxes_and_charges_field","master_doctype","tax_template","debounce","status","add_menu_item","send_sms","barcode","update_stock","show_batch_dialog","weight_uom","validate_company_and_party","pricing_rules","child","price_list_currency","plc_conversion_rate","order_type","ignore_pricing_rule","manufacturer","stock_uom","pos_profile","cost_center","item_tax_template","add_taxes_from_item_tax_template","free_item_data","apply_product_discount","is_internal_customer","is_internal_supplier","get_incoming_rate","script_manager","toggle_conversion_factor","get_single_value","k","apply_price_list","remove_pricing_rule","apply_rule_on_other_items","update_item_grid_labels","grid_rows","remove","voucher_type","item_args","allow_zero_valuation_rate","replace","user_defaults","set_qty_in_transactions_based_on_serial_no_input","setTimeout","update_qty","serialnos","valid_serial_nos","validate","set_default_internal_warehouse","default_in_transit_warehouse","set_pricing","company_doc","default_letter_head","letter_head","default_selling_terms","default_buying_terms","update_item_tax_map","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","ignore_price_list","get_exchange_rate","exchange_rate","set_margin_amount_based_on_currency","set_actual_charges_based_on_currency","in_apply_price_list","fail","from_currency","to_currency","freeze_message","dont_fetch_price_list_rate","is_a_mapped_document","Delivery Note Item","Sales Invoice Item","Purchase Receipt Item","Purchase Invoice Item","fields_map","toggle_enable","stock_uom_rate","service_stop_date","start_date","Date","service_start_date","end_date","service_end_date","stop_date","total_net_weight","toggle_reqd","price_list_name","change_form_labels","change_grid_labels","set_currency_labels","toggle_item_grid_columns","operations","item_grid","fname","set_column_disp","scrap_items","advances","update_payment_schedule_grid_labels","schedule_grid","recalculate","recalculate_values","calculate_charges","item_list","is_free_item","parent","row_item","_set_values_for_item_list","_get_args","_get_item_list","territory","campaign","sales_partner","coupon_code","append_item","item_group","brand","children","items_rule_dict","l","item_row","existing_pricing_rule","apply_rule_on","price_or_product_discount","exist_items","pr_row","reset_plc_conversion","always","remove_free_item","applied_on_items","apply_on","trigger_price_list_rate","valid","master_name","item_codes","item_rates","item_tax_templates","hasOwnProperty","as_json","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","join","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","quality_inspection","dialog_items","sample_size","sample_quantity","make_payment_via_journal_entry","set_query_for_item_tax_template","valid_from","terms_template","against_blanket_order","blanket_order","set_reserve_warehouse","autofill_warehouse","supplied_items","_last_coupon_code","_ignore_pricing_rule","on_close","receiving_stock","existing_stock","purpose","s_warehouse","require","SerialNoBatchSelector","warehouse_details","apply_putaway_rule","result","clear_table","ItemSelector","Class","init","item_query","add_items_button","render_items","focus","results","timeout_id","clearTimeout","added","add_new_row","timeout","as_dict","get_filters","link_search","image","abbr","get_abbr","get_palette","docsUrl","help","help_links","url","agriculture","TernaryPlot","[object Object]","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","append","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","soil_type","polygon","get_coords","fill","get_color","transform","offset","exec_once","rect","font-size","x_blip","y_blip","sin","blip","circle","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","concat","get_attributes_fields","check_naming_series_based_on","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","$input","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_form_if_not_list","error","open_doc","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","wrapper","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","prototype","toString","msgprint_dialog","CustomerQuickEntryForm","init_callback","force","skip_redirect_on_error","collapsible","SupplierQuickEntryForm","super","views","MarketplaceFactory","Factory","show_not_found","pages","marketplace","container","change_to","hub","make","page_name","Marketplace","make_page","CallPopup","call_log","caller_number","from","setup_listener","play_sound","static","minimizable","get_close_btn","setup_dialog","set_call_status","bind_actions_with_object","unbind","close_modal","bind","setup_call_details","caller_info","blink","classes","header","call_status","get_caller_name","set_indicator","set_title","missed","call_popup","update_call_log","clear_listeners","contact_link","get_contact_link","link_title","links","realtime","call_ended","off","call_details","FieldGroup","depends_on","create_new_contact","create_new_customer","hide_border","call_summary","call_type","xcall","summary","new_customer","new_contact","phone_no","phone","is_primary_mobile_no","window","setup_dimension_filters","accounting_dimensions","default_dimensions","fetch_custom_dimensions","with_cost_center_and_project","setup_filters","parent_fields","setup_child_filters","setup_account_filters","update_dimension","default_dimension","copy_from_first_row","ControlData","setup_phone","disp_area","style","has_icon","phone_call","handler","control","icon"],"mappings":"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"}